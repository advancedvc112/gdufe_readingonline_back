<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gdufe.readingonline.dal.mysqlmapper.GdufeLibraryEbookMapper">

    <!-- 根据ISBN查询电子书 -->
    <select id="selectByBookIsbn" parameterType="java.lang.String" resultType="com.gdufe.readingonline.dal.dataobject.GdufeLibraryEbookDO">
        SELECT * FROM gdufe_library_ebook WHERE book_ISBN = #{bookIsbn} AND is_deleted = 0
    </select>

    <!-- 批量插入或更新电子书数据（基于ISBN） -->
    <insert id="batchInsertOrUpdate" parameterType="java.util.List">
        INSERT INTO gdufe_library_ebook (
            book_name, book_ISBN, book_author, book_press, book_publication_time,
            book_url, book_brief_introduction, book_chinese_library_classification,
            book_subject_classification, book_primary_classification, book_secondary_classification,
            book_picture_url, book_source, is_deleted, create_time, update_time
        ) VALUES
        <foreach collection="list" item="item" separator=",">
            (
                #{item.bookName}, #{item.bookIsbn}, #{item.bookAuthor}, #{item.bookPress},
                #{item.bookPublicationTime}, #{item.bookUrl}, #{item.bookBriefIntroduction},
                #{item.bookChineseLibraryClassification}, #{item.bookSubjectClassification},
                #{item.bookPrimaryClassification}, #{item.bookSecondaryClassification},
                #{item.bookPictureUrl}, #{item.bookSource}, #{item.isDeleted},
                #{item.createTime}, #{item.updateTime}
            )
        </foreach>
        ON DUPLICATE KEY UPDATE
            book_name = VALUES(book_name),
            book_author = VALUES(book_author),
            book_press = VALUES(book_press),
            book_publication_time = VALUES(book_publication_time),
            book_url = VALUES(book_url),
            book_brief_introduction = VALUES(book_brief_introduction),
            book_chinese_library_classification = VALUES(book_chinese_library_classification),
            book_subject_classification = VALUES(book_subject_classification),
            book_primary_classification = VALUES(book_primary_classification),
            book_secondary_classification = VALUES(book_secondary_classification),
            book_picture_url = VALUES(book_picture_url),
            book_source = VALUES(book_source),
            is_deleted = VALUES(is_deleted),
            update_time = VALUES(update_time)
    </insert>

</mapper>
